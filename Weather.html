<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1">
    <title>Weather Forecast</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/react-router-dom@5.3.0/umd/react-router-dom.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>


<body>
    <div id="root"></div>

    <script type="text/babel">

        function App() {
            const [city, setCity] = React.useState("");
            const [weather, setWeather] = React.useState(null);
            const [loading, setLoading] = React.useState(false);
            const [error, setError] = React.useState("")
            const [theme, setTheme] = React.useState("dark");

            const toggleTheme = () => {
                setTheme(prev => prev === "light" ? "dark" : "light");
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                setLoading(true);
                setError("");
                setWeather(null);

                fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=8c4a3d9715cbe47da2afa57525734ae9&units=metric`)

                    .then(res => {
                        if (!res.ok) {
                            throw new Error("Invalid Place");
                        }
                        return res.json();

                    })

                    .then(data => {
                        console.log(data);
                        setWeather(data);
                        setLoading(false);
                    })

                    .catch(err => {
                        setError(err.message);
                        setLoading(false)
                    });
            };

            React.useEffect(() => {
                document.body.className = `bg-${theme} text-${theme === "light" ? "dark" : "light"}`;
            }, [theme])

            if (loading) return (<h5 className={`text-center pt-5 bg-${theme} text-${theme === "light" ? "dark" : "light"}`}> <span className="spinner-border spinner-border-sm me-2"></span>Loading</h5>);
            if (error) return (
                <div className="text-center">
                    <h5 className="text-center text-danger pt-5">Error: {error}</h5>
                    <button className="btn btn-secondary rounded" onClick={() => { setError(""); setLoading(false); setCity(''); }}>Go Back</button>
                </div>
            );

            return (
                <div className="container px-4">
                    <button className={`btn btn-${theme === "light" ? "dark" : "light"} text-${theme === "light" ? "light" : "dark"} rounded position-absolute top-0 end-0 p-2 m-2`} style={{ height: "50px", width: "50px" }} onClick={toggleTheme}>
                        {theme === "light" ? "üåô" : "‚òÄÔ∏è"}
                    </button>
                    <div className=" row text-center justify-content-center pt-5">
                        <div className="col-10 col-sm-8 col-md-6 mb-2 pb-2">
                            <form onSubmit={handleSubmit} className="text-center">
                                <h3>Weather</h3>
                                <input id="hi"
                                    type="search"
                                    className="form-control mb-3"
                                    placeholder="üîç Search Place"
                                    value={city}
                                    onChange={(e) => setCity(e.target.value)}
                                    required />
                                <button type="submit" className="btn btn-secondary rounded">Check</button>
                            </form>
                        </div>
                    </div>
                    <div className="row justify-content-center" >
                        <div className="col-md-6">
                            {weather && (
                                <div className="card mx-auto shadow my-3 p-3 p-sm-4 p-md-5 text-center" style={{ maxWidth: "400px", width: "100%" }}>
                                    <h4 className="mb-2"><strong>{weather.name}</strong></h4>
                                    <p className="mb-2">üå°Ô∏è{weather.main.temp}</p>
                                    <p className="text-capitalize">{weather.weather[0].description}</p>
                                    <img src={`https://openweathermap.org/img/wn/${weather.weather[0].icon}@2x.png`} />
                                    <p>üí® Wind: {weather.wind.speed} m/s</p>
                                </div>
                            )}
                        </div>
                    </div >
                </div>
            );
        }
        ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
</body>

</html>