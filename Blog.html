<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1">
    <title>Blog Searcher</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">

        function App() {
            const [tag, setTag] = React.useState("");
            const [info, setInfo] = React.useState(null);
            const [filter, setFilter] = React.useState([]);
            const [loading, setLoading] = React.useState(false);
            const [error, setError] = React.useState("")
            const [theme, setTheme] = React.useState("dark");

            const toggleTheme = () => {
                setTheme(prev => prev === "light" ? "dark" : "light");
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                setLoading(true);
                setError("");
                setInfo(null);

                fetch(`https://dummyjson.com/posts`)
                    .then(res => {
                        if (!res.ok) {
                            throw new Error("Invalid Tag");
                        }
                        return res.json();
                    })
                    .then(data => {
                        console.log(data);
                        setInfo(data);

                        let i = 0;
                        let match = [];
                        while (i < data.posts.length) { // Use data.posts, not info.posts
                            let j = 0;
                            while (j < data.posts[i].tags.length) {
                                if (tag.toLowerCase() === data.posts[i].tags[j].toLowerCase()) {
                                    match.push(data.posts[i]);
                                    break;
                                }
                                j++;
                            }
                            i++;
                        }

                        setFilter(match);
                        setLoading(false);
                    })
                    .catch(err => {
                        setError(err.message);
                        setLoading(false)
                    });
            };

            React.useEffect(() => {
                document.body.className = `bg-${theme} text-${theme === "light" ? "dark" : "light"}`;
            }, [theme])

            if (loading) return (<h5 className={`text-center pt-5 bg-${theme} text-${theme === "light" ? "dark" : "light"}`}> <span className="spinner-border spinner-border-sm me-2"></span>Loading</h5>);
            if (error) return (
                <div className="text-center">
                    <h5 className="text-center text-danger pt-5">Error: {error}</h5>
                    <button className="btn btn-secondary rounded" onClick={() => { setError(""); setLoading(false); setTag(''); }}>Go Back</button>
                </div>
            );

            return (
                <div className="container px-4">
                    <button className={`btn btn-${theme === "light" ? "dark" : "light"} text-${theme === "light" ? "light" : "dark"} rounded position-absolute top-0 end-0 p-2 m-2`} style={{ height: "50px", width: "50px" }} onClick={toggleTheme}>
                        {theme === "light" ? "üåô" : "‚òÄÔ∏è"}
                    </button>
                    <div className="row text-center justify-content-center pt-5">
                        <div className="col-10 col-sm-8 col-md-6 mb-2 pb-2">
                            <form onSubmit={handleSubmit} className="text-center">
                                <h3>Blog Searcher</h3>
                                <input id="hi"
                                    type="search"
                                    className="form-control mb-3"
                                    placeholder="üîç Search Tag (e.g. history, crime, love)"
                                    value={tag}
                                    onChange={(e) => setTag(e.target.value)}
                                    required />
                                <button type="submit" className="btn btn-secondary rounded">Search</button>
                            </form>
                        </div>
                    </div>

                    {filter.length > 0 && (
                        <div className="row">
                            <div className="col-12">
                                <h5 className="text-center mb-4">Found {filter.length} posts with tag "{tag}"</h5>
                                <div className="row">
                                    {filter.map(post => (
                                        <div key={post.id} className="col-md-6 col-lg-4 mb-4">
                                            <div className="card h-100 shadow">
                                                <div className="card-body d-flex flex-column">
                                                    <h5 className="card-title">{post.title}</h5>
                                                    <p className="card-text flex-grow-1">{post.body}</p>
                                                    <div className="mb-2">
                                                        {post.tags.map(tags => (
                                                            <span key={tags} className="badge bg-secondary me-1">{tags}</span>
                                                        ))}
                                                    </div>
                                                </div>
                                                <div className="card-footer bg-transparent">
                                                    <div className="d-flex justify-content-between text-muted small">
                                                        <span>üëç {post.reactions.likes}</span>
                                                        <span>üëé {post.reactions.dislikes}</span>
                                                        <span>üëÅÔ∏è {post.views}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}

                    {info && info.posts && filter.length === 0 && !loading && (
                        <div className="text-center card mx-auto shadow py-5 my-5">
                            <h5 className="card-title">No posts found!</h5>
                            <p className="card-text text-muted">Try searching for : History, Crime, Love, Mystery, American, English, French, Fiction, Magical, Classic</p>
                        </div>
                    )}
                </div>
            );
        }
        ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
</body>

</html>